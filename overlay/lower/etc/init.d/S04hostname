#!/bin/sh

. /etc/init.d/rc.common

start() {
	HOSTNAME=$(fw_printenv -n hostname 2> /dev/null)
	if [ -z "$HOSTNAME" ]; then
		OS_NAME=$(sed -n 's/^HOSTNAME=//p' /etc/os-release)
		MAC_SUFFIX=$(fw_printenv -n wlanmac | sed 's/://g;s/.*\(....\)$/\1/')
		HOSTNAME="${OS_NAME}-${MAC_SUFFIX}"
	fi
	starting
	hostname "$HOSTNAME" || die "FAIL"
	echo "OK"
	sed -i "/^127.0.1.1/s/\t.*$/\t$HOSTNAME/" /etc/hosts

}

case "$1" in
	start)
		$1
		;;
	stop)
		true
		;;
	*)
		die "Usage: $0 {start}"
		;;
esac

exit 0
